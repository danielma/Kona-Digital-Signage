var tickers=[];function appendScript(a){var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("src",a);document.getElementsByTagName("head")[0].appendChild(b)}String.prototype.capitalize=function(){return this.replace(/(^|\s)([a-z])/g,function(a,c,b){return c+b.toUpperCase()})};String.prototype.repeat=function(a){return[a+1].join(this)};var by_mealtime=function(d,c){var f=[d,c];for(var e=0;e<f.length;e++){switch(f[e].title.toLowerCase()){case"breakfast":f[e]=0;break;case"lunch":f[e]=1;break;case"dinner":f[e]=2;break;default:}}return f[0]-f[1]};var by_time=function(d,c){return d.start_time-c.start_time};function Event(a){if(typeof(a)!=="undefined"){this.title=a.title;this.start_time=a.start_time||Date.today();this.end_time=a.end_time||Date.today().set({hour:23,minute:59,second:59});this.location=a.location||"";this.description=a.description||"";this.attachment=a.attachment}}function Ticker(b){var a=this;if(typeof(b)!=="undefined"){this.element=$(b.element);this.items=b.items||[];this.speed=b.speed||10000;this.running=b.running||false;this.currentItem=0;this.interval=null;this.tickerHeight=0}this.setSize();if(this.running){this.start()}tickers.push(this);this.addItem=function(c){this.element.append(c);this.items.push(c);this.setSize();if(!this.running){this.start()}};this.start=function(){if(this.running){clearInterval(this.interval)}this.interval=setInterval(this.rotate,this.speed);this.running=true};this.stop=function(){clearInterval(this.interval);this.running=false};this.rotate=function(){if(a.items.length>1){$(a.element.children()[a.currentItem]).fadeOut(function(){a.stepCurrentItem();$(a.element.children()[a.currentItem]).fadeIn()})}else{$(a.element.children()[0]).fadeIn();a.stop()}};this.stepCurrentItem=function(){this.currentItem+=1;if(this.currentItem>(this.items.length-1)){this.currentItem=0}};this.setSize=function(){var d=this.element.parent().outerHeight();var c=this.element.siblings().outerHeight();var e=this.element.outerHeight()-this.element.height();this.tickerHeight=d-c-e;this.element.find("img").css("height",this.tickerHeight+"px")}}var videoPlayer={list:["1.webm","2.webm"],path:"videos/",currentVideo:0,element:null,fnQueue:[],playVideos:function(c){if(typeof(c)!="undefined"){this.list=c.list||this.list;this.path=c.path||this.path}$("#video .content").html("<video id='videoPlayer' src='"+this.path+this.list[0]+"' autoplay autobuffer />");var b=$("#video");var d=b.children().outerHeight()-b.children().height();var a=b.outerHeight()-d;this.element=$("#videoPlayer");this.element.css("max-height",a+"px").bind("ended",function(){videoPlayer.nextVideo()})},nextVideo:function(){if(this.fnQueue.length>0){for(var a=0;a<this.fnQueue.length;a++){this.fnQueue.pop()()}}this.currentVideo+=1;if(this.currentVideo>=this.list.length){this.currentVideo=0}this.element.attr("src",this.path+this.list[this.currentVideo]+this.format);this.element[0].play()},queueFn:function(a){this.fnQueue.push(a)},queueRefresh:function(){this.fnQueue.push(function(){location.reload(true)})}};var layoutParser={output:"",layout:{},parse:function(a){this.layout=a;this.recursiveParse(a,{id:a[0].parent});$("div[data-height], div[data-width]").each(function(c,f){var d=$(f);var b=d.attr("data-height");var e=d.attr("data-width");var g;if(typeof(b)!="undefined"){g=(b/100*(d.parent().height()-1));d.height(g+"px")}else{g=(e/100*(d.parent().width()-1));d.width(g+"px")}})},queueReloadData:function(a){setTimeout(function(){videoPlayer.queueFn(function(){layoutParser.loadData()})},a);setTimeout(function(){layoutParser.queueReloadData(a)},a)},loadData:function(c){if(typeof(c)==="undefined"){c=this.layout}for(var b=0;b<c.length;b++){var a=c[b];if(typeof(a.content)==="function"){a.content()}if(typeof(a.content)==="object"){this.loadData(a.content)}}},recursiveParse:function(h,l){var b="  ";for(var j=0;j<h.length;j++){var f=h[j];var a="";var d="";var c="";var e="";var k="";e="<div id='"+f.id+"'";e+=">";k="</div>";a=e+"<!-- !wrapin#"+f.id+"-->\n"+a;d+=k+"<!-- /wrapin#"+f.id+"-->\n";c+=a;if(typeof(f.content)==="function"){if(f.title){c+="<h1>"+f.title+"</h1>"}c+="<div class='content'>"+f.id+"</div>\n"}c+=d;$(c).appendTo("#"+l.id).css(f.css||{});var g=$("#"+f.id);if(typeof(f.content)==="object"){if(f.orient==="horizontal"){g.attr("data-height",f.size);g.addClass("hbox")}else{g.attr("data-width",f.size);g.addClass("vbox")}this.recursiveParse(f.content,f)}else{if(l.orient==="horizontal"){g.attr("data-width",f.size||100/l.content.length)}else{g.attr("data-height",f.size||100/l.content.length)}}}}};var imdbAPI={get_movie:function(b,c){var a=$.ajax({url:"http://www.imdbapi.com/",data:{t:b.title},dataType:"jsonp",timeout:10000,success:function(d){if(d.hasOwnProperty("Title")&&d.Title.toLowerCase()===b.title.toLowerCase()){b.attachment=d.Poster;b.title=d.Title;b.description=d.Plot;c(b)}else{c(b)}},error:function(d){c(b)}})}};var CalData={write_table:function(k,c,h){var f,a;var b=this.auto_format(h);h=b[0];f=b[1];a=b[2];var e="<table>";if(k.length===0){$(c).html("No events");return}for(var d=0;d<k.length;d++){var j=k[d];var g="";g=h.replace(/s\((.*?)\)/,j.start_time.toString(f));g=g.replace(/e\((.*?)\)/,j.end_time.toString(a));g=g.replace(/t\(\)/,j.title);g=g.replace(/d\(\)/,j.description);g=g.replace(/\n/g,"<br/>");g=g.replace(/\|/g,"</td><td>");e+="<tr><td>"+g+"</td></tr>"}e+="</table>";$(c).html(e)},ticker_html:function(e,f,d,c){var b="";var a="";a=f.replace(/s\(([\s\S]*?)\)/gm,e.start_time.toString(d));a=a.replace(/e\(([\s\S]*?)\)/gm,e.end_time.toString(c));a=a.replace(/\n/g,"<br/>");b+="<div class='item' style='display: none'>";if(e.attachment){b+="<img src='"+e.attachment+"' />"}b+="<div class='title'>"+e.title+"</div>";b+="<div class='time'>"+a+"</div>";b+="<div class='description'>"+e.description+"</div>";b+="</div>";return b},write_ticker:function(k,d,h,f){var e,a;var g=new Ticker({element:d});var b=this.auto_format(h);h=b[0];e=b[1];a=b[2];$(d).addClass("ticker");if(k.length===0){$(d).html("No events");return}else{$(d).html("");for(var c=0;c<k.length;c++){var j=k[c];if(f===true){imdbAPI.get_movie(j,this.makeCallback(g,j,h,e,a))}else{g.addItem(this.ticker_html(j,h,e,a))}}}},write_movies:function(b,a,c){this.write_ticker(b,a,c,true)},auto_format:function(c){var b,a;if(typeof(c)==="undefined"){b="h:mm";a="h:mm";c="s() - e() &mdash; t()"}else{c.replace(/s\(([\s\S]*?)\)/m,"");b=RegExp.$1;c.replace(/e\(([\s\S]*?)\)/m,"");a=RegExp.$1}return[c,b,a]},makeCallback:function(e,c,d,b,a){return function(){e.addItem(CalData.ticker_html(c,d,b,a))}}};var YConnect={date_format:"yyyy/MM/dd",get_calendar:function(d,i){var a="http://api.ywamconnect.net/menu/get.php";var c={format:"json"};var f={};var j=[];var g=Date.today();var b;switch(d){case"today":b=g;break;case"tomorrow":b=g.addDays(1);break;default:b=g}var e=[];c.month=b.getMonth()+1;c.year=b.getFullYear();f=c;e=b.toString(this.date_format);var h=$.ajax({url:a,data:f,dataType:"jsonp",timeout:10000});h.success(function(l){l=l.data[e];for(var k in l){if(l.hasOwnProperty(k)){j.push(new Event({title:k.toLowerCase().capitalize(),description:l[k]}))}}j=j.sort(by_mealtime);i(j)});h.error(function(k){})}};var GCal={service:new google.gdata.calendar.CalendarService("konaSignage-app"),kona_schedule:"or2b5kqjl58ndf8ien8atkcplg%40group.calendar.google.com",kona_events:"o2jfjbba7bcrhkk5p3scfqj7vc%40group.calendar.google.com",mauka_theater:"oebubbrli984mh257hd986td80%40group.calendar.google.com",get_calendar:function(a,f,j,e){if(typeof(e)==="undefined"){e=0}var b="https://www.google.com/calendar/feeds/"+a+"/public/full-noattendees";var i=new google.gdata.calendar.CalendarEventQuery(b);var d,g;var h=Date.today();var c=[];switch(f){case"today":c=[h];break;case"tomorrow":c=[h.addDays(1)];break;case"week":c=[h,h.clone().addDays(7)];break;case"upcoming":c=[h,false];break;default:}if(c.length>1){d=new google.gdata.DateTime(c[0]);if(c[1]){g=new google.gdata.DateTime(c[1].clone().set({hour:23,minute:59,second:59}))}else{g=null}}else{d=new google.gdata.DateTime(c[0]);g=new google.gdata.DateTime(c[0].clone().set({hour:23,minute:59,second:59}))}i.setOrderBy("starttime");i.setSortOrder("ascending");i.setSingleEvents(true);i.setMinimumStartTime(d);i.setMaximumStartTime(g);var k=[];this.service.getEventsFeed(i,function(n){var l=n.feed.entry;for(var m=0;m<l.length;m++){var o=l[m];k.push(new Event({title:o.getTitle().getText(),start_time:google.gdata.DateTime.fromIso8601(o.getTimes()[0].startTime).date,end_time:google.gdata.DateTime.fromIso8601(o.getTimes()[0].endTime).date,location:o.getLocations()[0].valueString,description:o.getSummary()}))}j(k)},function(){if(e>=3){videoPlayer.queueRefresh()}else{GCal.get_calendar(a,f,j,e+1)}})},get_two_calendars:function(c,b,a,d){this.get_calendar(c,a,function(e){GCal.get_calendar(b,a,function(g){var f=$.merge(e,g);f=f.sort(by_time);d(f)})})}};